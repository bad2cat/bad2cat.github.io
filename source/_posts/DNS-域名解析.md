---
title: DNS 如何实现域名的解析
date: 2022-03-13 20:08:56
categories:
- 网络
tags:
- DNS
- 域名解析
---

#### 域名解析

这两天在阿里云买了一个域名，然后又在`github`上搭建了一个个人博客，然后就按照官方的指导一步步的将域名解析到了`github`上搭建的个人博客上

<!-- more -->

后来就在想，这个域名是如何解析到`github`上的这个博客呢？这个解析又是什么意思呢？

现在看了一些介绍，慢慢的了解了；域名解析这个词有点抽象，但是换个词可能就比较好理解了，比如：IP登记，域名指向等，这几个词就比较清楚了

就 IP 登记而言，这个词就表明存在这么一个登记处，如果你想你的网站被别人能够访问到，就需要到这个登记处进行登记，在你登记的时候域名就相当于你的名字，IP就相当于你的住址；这样别人访问你的网站时通过域名就可以了，不再需要通过 IP 来访问了

上面所说的 IP 登记处就是 DNS 服务器了，每次当你在浏览器输入一个域名时，都会向 DNS 请求这个域名对应的 IP 地址，找到之后再通过 IP 完成具体的访问操作

##### 当你在浏览器输入域名之后，是谁去到 DNS 服务器帮你解析到域名对应的 IP 呢

因为浏览器本身不具备将消息发送到网络中的功能，所以这一步就是委托操作系统来完成的

操作系统在接收到请求之后，如果是看到是 IP 则直接发送到下一层了；如果是域名，则就会去启用 DNS 客户端，然后将域名交给 DNS 客户端，然后由 DNS 客户端去连接你网络配置的 DNS 服务器，连接之后请求返回该域名对应的 IP，获取到 IP 之后再交给操作系统，然后继续完成之后的网络请求操作

##### 如果本机配置的 DNS 服务器没有找到该域名对应的 IP 怎么办呢

配置 DNS 服务器，一开始也没有配置过 DNS 服务器，为什么也能够正常上网呢？

这是因为 DNS 服务器如果你没有配置，那就是动态的，每次上网时由网关分配，这种机制就叫做 DHCP；当然你也可以指定 DNS  服务器的 IP 地址，这是在网络配置中可以设置

不管你配置还是没有配置，只要你连接网络之后，都会一个 DNS 服务器，当你在浏览器输入域名之后，OS就会到这个 DNS 服务器上去请求域名对应的 IP 地址，如果请求到，则继续完成之前的请求；如果没有请求到，则就会进行分级查询了

###### 域名的层级

在了解域名的分级查询之前，先看一下域名的层级，因为就是通过域名的层级进行分级查询的；

下面是百度的域名

```
www.baidu.com.
```

通过域名解析工具，可以看到其实百度官网域名的后面会带一个`.`,这是因为所有的域名的尾部都会有一个根域名，完整的百度的域名应该是：

```
www.baidu.com.root
```

因为根域名`root`对所有的域名都一样的，所以平时都会省略点，就变成了`https://www.baidu.com.`

根域名的下一级域名叫做"顶级域名"（top-level domain，缩写 TLD），比如像`.com,.net`这些；

再下一级的域名叫做二级域名（second-level domain，缩写 SLD），如：`https://www.baidu.com.`中的`.baidu`，这一级的域名是用户可以注册到的；

再下一级的域名就是三级域名也是主机名，如：`www`，这是用户在自己的域里为服务器配置的名称，是用户可以任意分配的

##### 分级查询

所谓的分级查询就是当你在你配置的 DNS 服务器中找不到域名对应的 IP 之后，由当前的 DNS 服务器向根域名服务器发起的请求

首先说明一点，每一级域名都有自己的 `NS（Name Server）` 记录（记录域名服务器的记录，就是指定那些域名该有哪个 DNS 服务器来解析）

分级查询是从根域名开始，依次查找每一级域名的 NS 记录，找到查到最终的 IP 地址为止，具体查找过程如下：

```
1. 从 根域名服务器 找到顶级域名服务器的 NS 记录和 IP 地址
2. 从 顶级域名服务器 找到二级域名服务器的 NS 记录和 IP 地址
3. 从 二级域名服务器 找到 三级域名（主机名）的 IP 地址
```

那在分级查询到第一步中是如何知道根域名服务器的地址的呢

这是因为根域名服务器的 NS 记录和 IP 地址一般不会变，所以通常是内置在 DNS 服务器当中的

#### DNS 缓存

如果每次都需要这么解析一遍那么访问一个网站就会变的很慢了，同时也会对根域名服务器造成压力

因此通常就会对 DNS 解析的记录进行缓存，通常有两种缓存的方式：

###### 浏览器缓存

浏览器缓存就是每次会对访问过的域名对应的 IP 缓存起来，当然这个缓存的时间也是根据不同的浏览器的厂商而定的；谷歌的一般是缓存一分钟，也可以在谷歌浏览器中输入：`chrome://net-internals/#dns`来清除缓存

OS缓存

另外一种就是操作系统对于 DNS 的缓存，每次 DNS Client 请求得到的解析记录都会有一个 TTL 值，这个就是 DNS 服务器提供的 DNS 解析结果的最长存活时间，OS 缓存的 DNS 就会参考这个时间，但是不会完全的等于这个时间；通过命令`ipconfig/displaydns`就可以查看到本机的 DNS 缓存；也可以使用命令`ipconfig/flushdns`来清除这些缓存

##### DNS 劫持

上面介绍了 DNS 域名解析的原理，现在又有了一个新的问题：什么是 DNS 劫持？

正常情况下我们在浏览器输入请求后，OS 都会先到本机的 `hosts`文件查看是否有域名对应的 IP ，如果有则直接通过这个 IP 进行访问就可以了，如果没有，则就会到网络配置的 DNS 服务器上去获取当前域名对应的 IP 地址

但是，如果现在有一个木马程序，入侵你的电脑之后更改了你的 `hosts`文件，将你访问的百度的域名对应到一个广告网站或者是其他的恶意网站，此时你再访问`www.baidu.com`的时候出现的就不会是百度的首页了，而是修改之后的恶意网站了，这就是本地 DNS 劫持

本地 DNS 劫持就是因为病毒的入侵，所以你要安装杀毒软件，经常扫描；当然还需要开启防火墙，这样就可以防止病毒的入侵了

除了本地的 DNS 劫持外，还有就是路由器的 DNS 劫持，现在市场上的路由器的质量层级不齐，并且很多的用户买了路由器之后使用的还是默认的密码，所以很容易遭到攻击；

攻击获得管理权限之后，篡改路由器上设置的 DNS 服务器的地址，使其指向恶意的 DNS 服务器，这样当你发送请求的时候就会给你返回恶意网站的 IP地址；所以为了避免这种情况需要加强对路由器账号密码的管理，防止被恶意用户获取到路由器权限

第三种劫持就是攻击权威的 DNS 服务器，导致 DNS 服务器停止服务，还可以使用一些手段感染 DNS 缓存，给用户返回恶意的 IP 地址